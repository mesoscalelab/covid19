<!DOCTYPE html>
<html lang="en">
<head>
  <title>COVID-19 India</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.2/css/bootstrap-slider.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.2/bootstrap-slider.min.js"></script>

<script>
var db = [];

// region, population (millions), infected
db.push(["Uttar Pradesh",               199.81,  33]);
db.push(["Maharashtra",                 112.37,  87]);
db.push(["Bihar",                       104.01,   2]);
db.push(["West Bengal",                  91.27,   7]);
db.push(["Telangana",                    35.20,  22]);
db.push(["Andhra Pradesh",               49.70,   7]);
db.push(["Madhya Pradesh",               72.63,   7]);
db.push(["Tamil Nadu",                   72.15,  10]);
db.push(["Rajasthan",                    68.55,  33]);
db.push(["Karnataka",                    61.09,  37]);
db.push(["Gujarat",                      60.43,  29]);
db.push(["Orissa",                       41.97,   2]);
db.push(["Kerala",                       33.40,  95]);
db.push(["Jharkhand",                    32.98,   0]);
db.push(["Assam",                        31.20,   0]);
db.push(["Punjab",                       27.75,  21]);
db.push(["Chhattisgarh",                 25.54,   6]);
db.push(["Haryana",                      25.35,  26]);
db.push(["Delhi",                        16.78,  31]);
db.push(["Jammu and Kashmir",            12.54,   4]);
db.push(["Uttarakhand",                  10.08,   3]);
db.push(["Himachal Pradesh",              6.86,   3]);
db.push(["Tripura",                       3.67,   0]);
db.push(["Meghalaya",                     2.96,   0]);
db.push(["Manipur",                       2.85,   0]);
db.push(["Nagaland",                      1.98,   0]);
db.push(["Goa",                           1.46,   0]);
db.push(["Arunachal Pradesh",             1.38,   0]);
db.push(["Puducherry",                    1.24,   1]);
db.push(["Mizoram",                       1.09,   0]);
db.push(["Chandigarh",                    1.05,   5]);
db.push(["Sikkim",                        0.61,   0]);
db.push(["Andaman and Nicobar Islands",   0.38,   0]);
db.push(["Dadra and Nagar Haveli",        0.34,   0]);
db.push(["Daman and Diu",                 0.25,   0]);
db.push(["Lakshadweep",                   0.06,   0]);
db.push(["Ladakh",                        0.27,  13]);

// weeks starting dates
var T0_date        = "24/03/2020";
var T1_date        = "31/03/2020";
var T2_date        = "07/04/2020";
var T3_date        = "14/04/2020";
var T4_date        = "21/04/2020";

var default_region = "Karnataka";

// min, max and default of user parameters
var reg_every_n_min = 1;
var reg_every_n_max = 10;

const reg_every_n_pop_threshold = 10000000; // 10M
const reg_every_n_large_pop     = 3;
const reg_every_n_small_pop     = 2;

var cric_inf_pct_min = 0;
var cric_inf_pct_mod = 10;
var cric_inf_pct_wst = 15;
var cric_inf_pct_max = 20;
var cric_inf_pct_def = cric_inf_pct_wst;

var T1_igrowth_min =   2;
var T1_igrowth_mod =   5;
var T1_igrowth_wst =  10;
var T1_igrowth_max =  15;
var T1_igrowth_inc =   1;
var T1_igrowth_def = T1_igrowth_wst;

var T2_igrowth_min =  20;
var T2_igrowth_mod =  40;
var T2_igrowth_wst =  50;
var T2_igrowth_max =  60;
var T2_igrowth_inc =   2;
var T2_igrowth_def =  T2_igrowth_wst;

var T3_igrowth_min =  60;
var T3_igrowth_mod =  80;
var T3_igrowth_wst = 120;
var T3_igrowth_max = 150;
var T3_igrowth_inc =   5;
var T3_igrowth_def = T3_igrowth_wst;

var T4_igrowth_min = 155;
var T4_igrowth_mod = 200;
var T4_igrowth_wst = 500;
var T4_igrowth_max = 590;
var T4_igrowth_inc =  15;
var T4_igrowth_def = T4_igrowth_wst;

</script>
</head>

<body>
<div class="container app">
  <!-- title -->
  <h3 class="text-center font-weight-bold mt-3"><strong>COVID-19 Model for India</strong></h3>
  <h6 class="text-center">Prof. Santosh Ansumali, Engineering Mechanics Unit, JNCASR Bengaluru</h6>
  <h6 class="text-center">Prof. Aloke Kumar, Department of Mechanical Engineering, IISc Bengaluru</h6>
  <hr>

  <!-- region selector -->
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-4 m-2">
      <div class="text-center mb-2">
        <span>Select State or Union Territory: </span>
      </div>
      <div class="input-group">
        <div class="input-group-prepend">
          <span class="input-group-text"><i class="fa fa-map-marker"></i></span>
        </div>
        <input id="region-search" class="form-control" type="text" placeholder="Region...">
      </div>
      <ul id="region-list" class="list-group" style="display:none;">
      </ul>
    </div>
    <div class="col-md-4"></div>
  </div>

  <!-- registered infections -->
  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6 m-2 mt-4">
      <div class="text-center">
        <span>Infections registered* as of</span>
        <span class="font-weight-bold" id="T0-date">-</span>
        <span>:</span>
        <span id="T0-reg-inf">-</span><br>
        <a href="https://www.mohfw.gov.in/">*Ministry of Health and Family Welfare, Government of India</a>
      </div>
    </div>
    <div class="col-md-3"></div>
  </div>

  <!-- select user parameter : reg-every-n -->
  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6 mt-4 text-center">
      <div>
        <span>Inflation Factor** &nbsp; <strong>n</strong> =</span>
        <span class="font-weight-bold" id="reg-every-n-text">-</span>
      </div>
      <div>
        <input id="reg-every-n-slider" type="text" data-slider-id="n-slider"/>
      </div>
      <div>
        <span>**Assumes only one infected person registered out of every
              <strong>n</strong> infected persons</span>
      </div>
    </div>
    <div class="col-md-3"></div>
  </div>

  <!-- actual infections -->
  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6 m-2 mt-4">
      <div class="text-center">
        <span><strong>Estimated</strong> infections as of</span>
        <span id="T0-date1">-</span>
        <span>:</span>
        <span class="font-weight-bold" id="T0-infected">-</span>
      </div>
    </div>
    <div class="col-md-3"></div>
  </div>

  <!-- select user parameter : cric-inf-pct -->
  <div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-8 mt-4 text-center">
      <div>
        <span>Assuming <strong>x</strong> out of every hundred infected persons
        become critically ill, where</span>
      </div>
      <div>
        <span class="font-weight-bold">x =</span>
        <span class="font-weight-bold" id="cric-inf-pct-text">-</span>
      </div>
      <div>
        <input id="cric-inf-pct-slider" type="text" data-slider-id="x-slider"/>
      </div>
    </div>
    <div class="col-md-2"></div>
  </div>

  <!-- table section -->
  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6 mt-4">
      <div class="text-left">
        <span><strong><em>Prediction for next four weeks:</em></strong></span>
      </div>
    </div>
    <div class="col-md-3"></div>
  </div>

  <!-- predicted statistics -->
  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6 mt-2">
      <div class="pt-0">
        <table id="stats" class="table table-bordered">
          <thead>
            <tr>
              <th class="text-center" scope="col"><div><i class="fa fa-calendar"></i></div></th>
              <th class="text-center" scope="col">Infection Growth from <span id="T0-date2">-</span></th>
              <th class="text-center" scope="col">Growth Factor</th>
              <th class="text-center" scope="col">Infected</th>
              <th class="text-center" scope="col">Critical</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th id="T1-date" class="text-center" scope="row">-</th>
              <td class="text-center">
                <input id="T1-igrowth-slider" type="text" data-slider-id="T1-slider"/>
              </td>
              <td id="T1-igrowth"  class="text-center">-</td>
              <td id="T1-infected" class="text-right">-</td>
              <td id="T1-critical" class="text-right">-</td>
            </tr>
            <tr>
              <th id="T2-date" class="text-center" scope="row">-</th>
              <td class="text-center">
                <input id="T2-igrowth-slider" type="text" data-slider-id="T2-slider"/>
              </td>
              <td id="T2-igrowth"  class="text-center">-</td>
              <td id="T2-infected" class="text-right">-</td>
              <td id="T2-critical" class="text-right">-</td>
            </tr>
            <tr>
              <th id="T3-date" class="text-center" scope="row">-</th>
              <td class="text-center">
                <input id="T3-igrowth-slider" type="text" data-slider-id="T3-slider"/>
              </td>
              <td id="T3-igrowth"  class="text-center">-</td>
              <td id="T3-infected" class="text-right">-</td>
              <td id="T3-critical" class="text-right">-</td>
            </tr>
            <tr>
              <th id="T4-date" class="text-center" scope="row">-</th>
              <td class="text-center">
                <input id="T4-igrowth-slider" type="text" data-slider-id="T4-slider"/>
              </td>
              <td id="T4-igrowth"  class="text-center">-</td>
              <td id="T4-infected" class="text-right">-</td>
              <td id="T4-critical" class="text-right">-</td>
            </tr>
          </tbody>
        </table>
      </div>
    <div class="text-left">
      <span>Parameters for moderate and worst case scenarios are marked with</span>
      <span style="color: green">green</span>
      <span>and</span>
      <span style="color: red">red</span>
      <span>stops, respectively, on the sliders</span>
    </div>
    </div>
    <div class="col-md-3"></div>
  </div>


<style>
#n-slider .slider-selection {
	background: lightblue;
}

#x-slider .slider-selection {
	background: lightblue;
}

#x-slider .slider-rangeHighlight.moderate {
    background: green;
}

#x-slider .slider-rangeHighlight.worst {
    background: red;
}

#T1-slider .slider-selection {
	background: lightblue;
}

#T1-slider .slider-rangeHighlight.moderate {
    background: green;
}

#T1-slider .slider-rangeHighlight.worst {
    background: red;
}

#T2-slider .slider-selection {
	background: lightblue;
}

#T2-slider .slider-rangeHighlight.moderate {
    background: green;
}

#T2-slider .slider-rangeHighlight.worst {
    background: red;
}

#T3-slider .slider-selection {
	background: lightblue;
}

#T3-slider .slider-rangeHighlight.moderate {
    background: green;
}

#T3-slider .slider-rangeHighlight.worst {
    background: red;
}

#T4-slider .slider-selection {
	background: lightblue;
}

#T4-slider .slider-rangeHighlight.moderate {
    background: green;
}

#T4-slider .slider-rangeHighlight.worst {
    background: red;
}
</style>
<script>

// create sliders
var reg_every_n_slider = new Slider("#reg-every-n-slider", {
  id   : 'n-slider',
  min  : reg_every_n_min,
  max  : reg_every_n_max,
  step : 1,
  value: reg_every_n_min});

var cric_inf_pct_slider = new Slider("#cric-inf-pct-slider", {
  id   : 'x-slider',
  min  : cric_inf_pct_min,
  max  : cric_inf_pct_max,
  step : 1,
  value: cric_inf_pct_def,
  rangeHighlights: [{ "start": cric_inf_pct_mod - 0.5, "end": cric_inf_pct_mod + 0.5, "class": "moderate" },
                    { "start": cric_inf_pct_wst - 0.5, "end": cric_inf_pct_wst + 0.5, "class": "worst" }]});

var T1_igrowth_slider = new Slider("#T1-igrowth-slider", {
  id   : 'T1-slider',
  min  : T1_igrowth_min,
  max  : T1_igrowth_max,
  step : T1_igrowth_inc,
  value: T1_igrowth_def,
  rangeHighlights: [{ "start": T1_igrowth_mod - 0.5 * T1_igrowth_inc, "end": T1_igrowth_mod + 0.5 * T1_igrowth_inc, "class": "moderate" },
                    { "start": T1_igrowth_wst - 0.5 * T1_igrowth_inc, "end": T1_igrowth_wst + 0.5 * T1_igrowth_inc, "class": "worst" }]});

var T2_igrowth_slider = new Slider("#T2-igrowth-slider", {
  id   : 'T2-slider',
  min  : T2_igrowth_min,
  max  : T2_igrowth_max,
  step : T2_igrowth_inc,
  value: T2_igrowth_def,
  rangeHighlights: [{ "start": T2_igrowth_mod - 0.5 * T2_igrowth_inc, "end": T2_igrowth_mod + 0.5 * T2_igrowth_inc, "class": "moderate" },
                    { "start": T2_igrowth_wst - 0.5 * T2_igrowth_inc, "end": T2_igrowth_wst + 0.5 * T2_igrowth_inc, "class": "worst" }]});

var T3_igrowth_slider = new Slider("#T3-igrowth-slider", {
  id   : 'T3-slider',
  min  : T3_igrowth_min,
  max  : T3_igrowth_max,
  step : T3_igrowth_inc,
  value: T3_igrowth_def,
  rangeHighlights: [{ "start": T3_igrowth_mod - 0.5 * T3_igrowth_inc, "end": T3_igrowth_mod + 0.5 * T3_igrowth_inc, "class": "moderate" },
                    { "start": T3_igrowth_wst - 0.5 * T3_igrowth_inc, "end": T3_igrowth_wst + 0.5 * T3_igrowth_inc, "class": "worst" }]});

var T4_igrowth_slider = new Slider("#T4-igrowth-slider", {
  id   : 'T4-slider',
  min  : T4_igrowth_min,
  max  : T4_igrowth_max,
  step : T4_igrowth_inc,
  value: T4_igrowth_def,
  rangeHighlights: [{ "start": T4_igrowth_mod - 0.5 * T4_igrowth_inc, "end": T4_igrowth_mod + 0.5 * T4_igrowth_inc, "class": "moderate" },
                    { "start": T4_igrowth_wst - 0.5 * T4_igrowth_inc, "end": T4_igrowth_wst + 0.5 * T4_igrowth_inc, "class": "worst" }]});

// initialization
var region       = default_region;
var reg_every_n  = reg_every_n_slider.getValue();
var cric_inf_pct = cric_inf_pct_slider.getValue();
var T1_igrowth   = T1_igrowth_slider.getValue();
var T2_igrowth   = T2_igrowth_slider.getValue();
var T3_igrowth   = T3_igrowth_slider.getValue();
var T4_igrowth   = T4_igrowth_slider.getValue();

// fill prediction statistics table
function set_stats(t_reset_for_region) {
  let region_data = db[0];
  for (let i = 0; i < db.length; i++) {
    if (db[i][0] == region) {
      region_data = db[i];
    }
  }

  let pop = Math.floor(1000000 * region_data[1]);
  if (t_reset_for_region) {
    document.getElementById("region-search").value = region;
    if (pop > reg_every_n_pop_threshold) {
      reg_every_n_slider.setValue(reg_every_n_large_pop);
    } else {
      reg_every_n_slider.setValue(reg_every_n_small_pop);
    }
    reg_every_n = reg_every_n_slider.getValue();
  }

  let T0_reg_inf  = region_data[2];
  let T0_infected = Math.min(Math.floor(Math.max(T0_reg_inf, 1) * reg_every_n), pop);

  let T1_infected = Math.min(Math.floor(T0_infected * T1_igrowth), pop);
  let T1_critical = Math.min(Math.floor(T1_infected * cric_inf_pct * 0.01), pop);

  let T2_infected = Math.min(Math.floor(T0_infected * T2_igrowth), pop);
  let T2_critical = Math.min(Math.floor(T2_infected * cric_inf_pct * 0.01), pop);

  let T3_infected = Math.min(Math.floor(T0_infected * T3_igrowth), pop);
  let T3_critical = Math.min(Math.floor(T3_infected * cric_inf_pct * 0.01), pop);

  let T4_infected = Math.min(Math.floor(T0_infected * T4_igrowth), pop);
  let T4_critical = Math.min(Math.floor(T4_infected * cric_inf_pct * 0.01), pop);

  document.getElementById("reg-every-n-text").innerHTML  = reg_every_n;
  document.getElementById("cric-inf-pct-text").innerHTML = Math.floor(cric_inf_pct);
  document.getElementById("T0-date").innerHTML           = T0_date;
  document.getElementById("T0-reg-inf").innerHTML        = T0_reg_inf;
  document.getElementById("T0-date1").innerHTML          = T0_date;
  document.getElementById("T0-infected").innerHTML       = T0_infected;
  document.getElementById("T0-date2").innerHTML          = T0_date;
 
  document.getElementById("T1-date").innerHTML           = T1_date;
  document.getElementById("T1-igrowth").innerHTML        = Math.floor(T1_igrowth).toString().concat("x");
  document.getElementById("T1-infected").innerHTML       = T1_infected;
  document.getElementById("T1-critical").innerHTML       = T1_critical;
 
  document.getElementById("T2-date").innerHTML           = T2_date;
  document.getElementById("T2-igrowth").innerHTML        = Math.floor(T2_igrowth).toString().concat("x");
  document.getElementById("T2-infected").innerHTML       = T2_infected;
  document.getElementById("T2-critical").innerHTML       = T2_critical;
 
  document.getElementById("T3-date").innerHTML           = T3_date;
  document.getElementById("T3-igrowth").innerHTML        = Math.floor(T3_igrowth).toString().concat("x");
  document.getElementById("T3-infected").innerHTML       = T3_infected;
  document.getElementById("T3-critical").innerHTML       = T3_critical;
 
  document.getElementById("T4-date").innerHTML           = T4_date;
  document.getElementById("T4-igrowth").innerHTML        = Math.floor(T4_igrowth).toString().concat("x");
  document.getElementById("T4-infected").innerHTML       = T4_infected;
  document.getElementById("T4-critical").innerHTML       = T4_critical;
}

// initialize
set_stats(true);

// fill region list from database
// TODO change var to let in for loop
var region_list = document.getElementById("region-list");
for (let i = 0; i < db.length; i++) {
  let entry = document.createElement('li');
  entry.appendChild(document.createTextNode(db[i][0]));
  entry.classList.add("region-name");
  entry.classList.add("list-group-item");
  region_list.appendChild(entry);
}

// select region
var region_search = document.getElementById("region-search");
region_search.addEventListener("keyup", function(e) {
  let value = $(this).val().toLowerCase();
  if (value == "") {
    region_list.style.display = "none";
  } else {
    region_list.style.display = "block";
  }
  $("#region-list li").filter(function() {
    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
  });
});
var region_objects = document.getElementsByClassName("region-name");
for (let i = 0; i < region_objects.length; i++) {
  region_objects[i].addEventListener("click", function(e) {
    let region_name = e.target.textContent;
    document.getElementById("region-list").style.display = "none";
    region = region_name;
    set_stats(true);
  });
}

// select value of reg-every-n
reg_every_n_slider.on('slide', function() {
  reg_every_n = reg_every_n_slider.getValue();
  set_stats(false);
});

// select value of cric-inf-pct
cric_inf_pct_slider.on('slide', function() {
  cric_inf_pct = cric_inf_pct_slider.getValue();
  set_stats(false);
});

// select value of T1-igrowth
T1_igrowth_slider.on('slide', function() {
  T1_igrowth = T1_igrowth_slider.getValue();
  set_stats(false);
});

// select value of T2-igrowth
T2_igrowth_slider.on('slide', function() {
  T2_igrowth = T2_igrowth_slider.getValue();
  set_stats(false);
});

// select value of T13-igrowth
T3_igrowth_slider.on('slide', function() {
  T3_igrowth = T3_igrowth_slider.getValue();
  set_stats(false);
});

// select value of T4-igrowth
T4_igrowth_slider.on('slide', function() {
  T4_igrowth = T4_igrowth_slider.getValue();
  set_stats(false);
});

</script>
</body>
</html>
