<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
  <title>Test Functions</title>
</head>
<body>
<script src="js/covid19-model-india.js"></script>
<script>
let urls = [];
urls.push("https://api.covid19india.org/states_daily.json");
urls.push("https://api.covid19india.org/raw_data.json");

let promises = [];
urls.forEach(function(url) {
  promises.push(fetch(url).then(data => data.json()));
});

Promise.all(promises).then(function(data) {
  init(data);
});

function init(data)
{
  let statesSeries = data[0].states_daily;
  let caseSeries   = data[1].raw_data;


  let t0 = new Date();
  t0.setDate(t0.getDate() - 1);
  console.log("t0 = " + t0);

  let t = new Date("2020-04-28");
  let category = "reported";
  const stateName = "Maharashtra";
  const districtName = "Mumbai";

  let model = new Covid19ModelIndia(t0, statesSeries, caseSeries);

  const cstat = model.countryStatLimit(category, t);
  console.log(cstat);

  const state = model.indexStateName(stateName);
  const sstat = model.stateStatLimit(category, state, t);
  console.log(sstat);

  const districtNameKey = model.districtNameKey(districtName, stateName);
  const district = model.indexDistrictNameKey(districtNameKey);
  const dstat = model.districtStatLimit(category, district, t);
  console.log(dstat);

  let day1 = new Date("2020-04-23");
  let day2 = new Date("2020-04-29");
  let day3 = new Date("2020-04-30");
  let dcount1 = model.countryStatLimit("deceased", day1).mid;
  let dcount2 = model.countryStatLimit("deceased", day2).mid;
  let dcount3 = model.countryStatLimit("deceased", day3).mid;
  console.log(dcount1);
  console.log(dcount2 + " " + (dcount2-dcount1));
  console.log(dcount3 + " " + (dcount3-dcount1));

}
</script>
</body>
</html>
